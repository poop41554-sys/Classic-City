# MTA:SA Gaming Shop Platform

## Overview

This is a full-stack e-commerce platform for an MTA:SA (Multi Theft Auto: San Andreas) gaming server. Players can purchase in-game items (vehicles, features, ownership perks) using a virtual coin economy. The platform features Arabic-first RTL design with a gaming aesthetic inspired by platforms like Steam and Epic Games, combined with GTA:SA's urban/street style.

The application uses a monorepo structure with a React frontend, Express backend, PostgreSQL database via Neon serverless, and session-based authentication with CSRF protection.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture

**Framework & Build System**
- React 18 with TypeScript for type-safe component development
- Vite as the build tool and development server with hot module replacement
- Wouter for lightweight client-side routing (React Router alternative)
- TanStack Query (React Query) for server state management, caching, and API calls

**UI Component Library**
- shadcn/ui components built on Radix UI primitives for accessible, customizable components
- Tailwind CSS for utility-first styling with custom design system
- Class Variance Authority (CVA) for component variant management
- Arabic-first RTL layout with Cairo and Tajawal font families

**State Management Strategy**
- Server state managed via TanStack Query with automatic caching and refetching
- Session state fetched from `/api/user` endpoint to determine authentication status
- No global client state management (Redux/Zustand) - relies on React Query cache
- CSRF token management handled in queryClient utility with automatic header injection

**Design System**
- Dark-dominant theme with light mode support via ThemeProvider context
- Gaming aesthetic with gradient accents (primary blue, gold highlights)
- Custom CSS variables for consistent theming across light/dark modes
- Responsive grid layouts: mobile-first with breakpoints at md (768px) and lg (1024px)

**Security Measures (Client-Side)**
- SecurityProtection component blocks F12, right-click, and detects DevTools opening
- CSRF tokens automatically included in mutation requests
- Session cookies used for authentication (httpOnly, secure)

### Backend Architecture

**Server Framework**
- Express.js with TypeScript for type-safe API development
- Separation of concerns: `app.ts` for middleware setup, `routes.ts` for endpoint definitions
- Development mode uses Vite middleware for SSR, production serves static build
- Custom logging middleware for request/response tracking

**Authentication & Session Management**
- express-session with connect-pg-simple for PostgreSQL-backed session store
- Two authentication methods:
  1. Login codes generated in-game, validated and consumed once
  2. Discord OAuth (placeholder implementation visible in routes)
- CSRF protection via csurf middleware for all mutating requests
- Session data stores userId, admin status checked on protected routes

**Security Middleware Stack**
- Helmet.js for security headers (CSP, XSS protection, etc.)
- CORS configured for cross-origin requests
- Rate limiting via express-rate-limit to prevent abuse
- Cookie parser for secure session cookie handling
- Raw body verification for webhook-style integrations

**API Design Pattern**
- RESTful endpoints under `/api` namespace
- Standard CRUD operations with proper HTTP verbs (GET, POST, PUT, DELETE)
- JSON request/response format with consistent error handling
- Middleware chain: cors → helmet → rate limiting → session → csrf → route handlers

**Business Logic Layer**
- Storage abstraction (`IStorage` interface) allows swapping database implementations
- Transaction handling for critical operations (e.g., purchase = deduct coins + create record)
- Admin-only routes protected by `requireAdmin` middleware

### Data Layer

**Database**
- PostgreSQL via Neon serverless (WebSocket-based connection pooling)
- Drizzle ORM for type-safe database queries and schema management
- Schema-first approach: `shared/schema.ts` defines tables and validation schemas

**Schema Design**

*Users Table*
- Stores player data: username, Discord OAuth info, coin balance, admin flag
- UUID primary keys for security (no sequential IDs)
- Timestamps for account creation tracking

*Login Codes Table*
- One-time codes generated by MTA server for web authentication
- Expiration timestamps to prevent old code reuse
- Links to user after successful login

*Products Table*
- Categorized items: vehicles, features, ownership
- Stock management with `inStock` boolean flag
- Featured/new badges for promotional display
- Image paths reference `/attached_assets/generated_images/`

*Purchases Table*
- Transaction records linking users to products
- Status tracking: pending, delivered, cancelled
- Price snapshot at time of purchase (historical pricing)

**Migration Strategy**
- Drizzle Kit for schema migrations in `/migrations` directory
- Push command for development, proper migrations for production
- Database URL from environment variable with validation

### External Dependencies

**Database Service**
- Neon Serverless PostgreSQL: Managed database with WebSocket connections for serverless environments
- Connection pooling via `@neondatabase/serverless` package

**UI Component Libraries**
- Radix UI: Headless, accessible component primitives (dialogs, dropdowns, tooltips, etc.)
- React Hook Form + Zod: Form handling with schema validation
- Lucide React: Icon library for consistent iconography

**Authentication & Security**
- bcrypt: Password hashing (currently unused but installed for future use)
- csurf: CSRF token generation and validation
- express-session + connect-pg-simple: Server-side session management

**Development Tools**
- Replit-specific plugins: runtime error overlay, cartographer for code navigation, dev banner
- tsx: TypeScript execution for development server
- esbuild: Fast bundling for production builds

**Session Storage**
- PostgreSQL-backed sessions via connect-pg-simple (stores session data in database table)

**Future Integrations (Placeholders)**
- Discord OAuth: Routes exist but implementation incomplete
- MTA:SA Server: Login code generation happens game-side, webhook endpoints may be added